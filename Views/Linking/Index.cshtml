@{
    ViewData["Title"] = "Emulate Linking";
}

<div class="container mt-5">
    <h1>Post-Registration Linking</h1>
    <p>This is a pretend post registration step to emulate linking to a member. The action below forces a refresh of
        your claims from Entra ID to pick up the new LinkedMember role (assuming it was assigned in the portal).</p>

    @if (TempData["ValidationMessage"] != null)
    {
        <div class="alert alert-warning" role="alert">
            <strong>Validation Error:</strong> @TempData["ValidationMessage"]
        </div>
    }

    @if (User.IsInRole("LinkedMember"))
    {
    <div class="alert alert-success" role="alert">
        <h4 class="alert-heading">You are already linked!</h4>
        <p>Your account is already linked to a pension member. No further action is needed.</p>
    </div>
    }
    else
    {
    <div class="card p-4 shadow">
        <h5 class="card-title mb-3">Verification Details</h5>
        <p class="text-muted small">
            This step emulates collecting identifying data and validating it against a backend system (like a membership
            database).
            <br>For this POC, enter NI: AB123456C and Ref: 123456 to proceed.
        </p>


        <form asp-controller="Linking" asp-action="LinkAndRefreshClaims" method="post">
            @Html.AntiForgeryToken()

            <div class="mb-3">
                <label for="niNumber" class="form-label">NI Number</label>
                <input type="text" class="form-control" id="niNumber" name="niNumber" required
                    placeholder="e.g., AB123456C">
            </div>

            <div class="mb-4">
                <label for="policyRef" class="form-label">Policy Reference</label>
                <input type="text" class="form-control" id="policyRef" name="policyRef" required
                    placeholder="e.g., 123456">
            </div>

            <button type="submit" class="btn btn-primary btn-lg w-100">
                Verify & Emulate Linking
            </button>
        </form>
    </div>

    }

</div>